import{j as n,r as a,R as Z}from"./index-q0DRrb5u.js";const y=e=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"#FFF",viewBox:"0 -960 960 960",...e,children:n.jsx("path",{d:"m380-300 280-180-280-180v360ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"})}),E=e=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"#FFF",viewBox:"0 -960 960 960",...e,children:n.jsx("path",{d:"M480-40q-23 0-46-3t-46-8Q300 14 194.5-4.5T33-117q-45-74-29-159t77-143v-3Q19-479 4-562.5T32-720q37-63 102-95.5T271-838q32-57 87.5-89.5T480-960q66 0 121.5 32.5T689-838q72-10 137 22.5T928-720q43 74 28 157.5T879-422v3q61 58 77 143t-29 159Q871-23 765.5-4.5T572-51q-23 5-46 8t-46 3ZM288-90q-32-18-61-41.5T174-183q-24-28-42.5-60.5T101-311q-20 36-20 76.5t21 75.5q29 48 81.5 68.5T288-90Zm384 0q52 20 104.5-.5T858-159q21-35 21-75.5T859-311q-12 35-30.5 67.5T786-183q-24 28-52.5 51.5T672-90Zm-192-30q134 0 227-93t93-227q0-29-4.5-55.5T782-547q-29 20-64 31t-73 11q-102 0-173.5-71.5T400-750q-104 26-172 112t-68 198q0 134 93 227t227 93ZM360-350q-21 0-35.5-14.5T310-400q0-21 14.5-35.5T360-450q21 0 35.5 14.5T410-400q0 21-14.5 35.5T360-350Zm240 0q-21 0-35.5-14.5T550-400q0-21 14.5-35.5T600-450q21 0 35.5 14.5T650-400q0 21-14.5 35.5T600-350ZM94-544q9-33 23-63.5t33-57.5q19-27 41.5-51t48.5-44q-43 0-79.5 21T102-681q-20 32-22 67t14 70Zm772 0q16-35 14-70t-22-67q-22-37-58.5-58T720-760q26 20 48.5 44t41.5 51q19 27 33 57.5t23 63.5Zm-221-41q29 0 54-9t46-25q-21-32-50-57.5T632-721q-34-19-72-29t-80-10v10q0 69 48 117t117 48Zm-54-239q-20-26-49-41t-62-15q-33 0-62 15t-49 41q26-8 54-12t57-4q29 0 57 4t54 12ZM150-665Zm660 0Zm-330-85Zm0-90ZM174-183Zm612 0Z"})}),j=e=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"#FFF",viewBox:"0 -960 960 960",className:`animate-spin ${e.className}`,...e,children:n.jsx("path",{d:"M440-122q-121-15-200.5-105.5T160-440q0-66 26-126.5T260-672l57 57q-38 34-57.5 79T240-440q0 88 56 155.5T440-202v80Zm80 0v-80q87-16 143.5-83T720-440q0-100-70-170t-170-70h-3l44 44-56 56-140-140 140-140 56 56-44 44h3q134 0 227 93t93 227q0 121-79.5 211.5T520-122Z"})}),R={LoaderIcon:j,SlidesIcon:y,VoxIcon:E},L=({name:e,className:s,...t})=>{const o=R[e];return o?n.jsx(o,{className:s,...t}):(console.warn(`Icon "${e}" not found in iconMap`),null)};function A({name:e,className:s,onClick:t,...o}){return n.jsx("div",{className:"bg-slate-500 p-2 rounded-full cursor-pointer",onClick:t,children:n.jsx(L,{name:e,className:s,...o})})}function b({isLoading:e,...s}){return e?n.jsx("div",{className:"p-2",children:n.jsx(j,{})}):n.jsx(A,{...s})}const C=e=>{window.postMessage({source:"button-accessor",type:"generateSlides",payload:e},window.location.origin)},m="https://chatgpt.com",T="https://www.mistral.ai",B="https://www.perplexity.ai",M={[m]:{selector:".markdown",platform:"chatgpt"},[T]:{selector:".message-content",platform:"mistral"},[B]:{selector:".user-message-content",platform:"perplexity"}},F=()=>{const e=window.location.href;if(e.includes(m))return e.split("/")[4];if(e.includes(T))return e.split("/")[4]},v=e=>{if(window.location.href.includes(m)){const t=e,o=t==null?void 0:t.parentElement;return o==null?void 0:o.parentElement}},N=e=>{const s=window.location.href;if(s.includes(m)){const t=v(e);return t==null?void 0:t.getAttribute("data-message-id")}else if(s.includes(T))return s.split("/")[4]},U=e=>{if(window.location.href.includes(m)){const t=v(e),o=t==null?void 0:t.getAttribute("data-message-id"),r=t.querySelector(".markdown");r==null||r.setAttribute(`data-switch-format-${o}`,"chats");const l=document.createElement("div");return l.setAttribute(`data-switch-format-${o}`,"slides"),l.style.display="hidden",t.appendChild(l),t}};function $(){const e=a.useRef(null),[s,t]=a.useState(null),[o,r]=a.useState(null),[l,q]=a.useState(!1);a.useEffect(()=>{if(e.current){const c=N(e.current);r(c)}},[]),a.useEffect(()=>{if(!e.current)return;const c=v(e.current),u=f=>{console.log("Received generateSlidesResponse event in React",f);const{payload:g,error:d}=f.detail;d?console.error("Error generating slides:",d):(console.log("Slides data in React:",g),t(g)),q(!1)};return console.log("Attaching event listener on:",c),c.addEventListener("generateSlidesResponse",u),()=>{c.removeEventListener("generateSlidesResponse",u)}},[e.current]),a.useEffect(()=>{if(s!=null&&s.length&&e.current){const c=U(e.current);console.log("currentdiv",c)}},[s,e.current]);const x=()=>{if(!e.current||!o)return;q(!0);const c=window.location.href,u=Object.keys(M).find(I=>c.includes(I));if(!u){console.error("Unsupported platform"),q(!1);return}const{selector:f,platform:g}=M[u],d=e.current,p=d==null?void 0:d.parentElement,w=p==null?void 0:p.parentElement,i=w==null?void 0:w.querySelector(f);console.log("Sending generateSlides message from React..."),C({messageId:o,data:(i==null?void 0:i.textContent)??"",model:g==="chatgpt"?"gpt-4.0":"mistral-large",platform:g,conversationId:F()}),console.log({innerHTML:i==null?void 0:i.innerHTML,textContent:i==null?void 0:i.textContent})};return n.jsxs("div",{className:"flex gap-2",ref:e,children:[s?`Slides: ${s.length}`:"No slides",o,n.jsx(b,{isLoading:l,name:"SlidesIcon",onClick:x}),n.jsx(b,{isLoading:l,name:"VoxIcon",onClick:x})]})}const S="https://chatgpt.com",k=[S],H={[S]:'div[data-message-author-role="assistant"][data-message-id]'};function O(e,s){let t=null;return(...o)=>{t&&clearTimeout(t),t=setTimeout(()=>e(...o),s)}}function P(e,s){if(e.hasAttribute("button-accessor-root")){console.log("Button already injected for message",s);return}const t=document.createElement("div");t.className="button-accessor-root",t.style.display="inline-block",t.style.marginLeft="10px",t.style.position="relative",t.textContent="Button",t.setAttribute("data-index",s.toString()),e.prepend(t),e.setAttribute("data-button-injected","true");try{Z.createRoot(t).render(n.jsx($,{})),console.log("ButtonAccessorViewer rendered for message",s)}catch(o){console.error("Error rendering ButtonAccessorViewer for message",s,o)}}function V(){console.log("Processing chat messages");const e=window.location.href,s=k.find(r=>e.includes(r));if(!s){console.log("Not a chat website. Exiting.");return}const t=H[s],o=document.querySelectorAll(`${t}:not([data-button-injected])`);console.log("Found unprocessed messages:",o.length),o.forEach((r,l)=>{P(r,l)})}const h=O(V,100);document.addEventListener("DOMContentLoaded",()=>{console.log("DOM fully loaded"),h(),new MutationObserver(s=>{s.some(t=>t.addedNodes.length)&&(console.log("DOM changes detected, reprocessing messages"),h())}).observe(document.body,{childList:!0,subtree:!0})});setInterval(h,1e3);h();
