import{j as s,r as g,R as A}from"./index-q0DRrb5u.js";const C=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"#FFF",viewBox:"0 -960 960 960",...e,children:s.jsx("path",{d:"m380-300 280-180-280-180v360ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"})}),V=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"#FFF",viewBox:"0 -960 960 960",...e,children:s.jsx("path",{d:"M480-40q-23 0-46-3t-46-8Q300 14 194.5-4.5T33-117q-45-74-29-159t77-143v-3Q19-479 4-562.5T32-720q37-63 102-95.5T271-838q32-57 87.5-89.5T480-960q66 0 121.5 32.5T689-838q72-10 137 22.5T928-720q43 74 28 157.5T879-422v3q61 58 77 143t-29 159Q871-23 765.5-4.5T572-51q-23 5-46 8t-46 3ZM288-90q-32-18-61-41.5T174-183q-24-28-42.5-60.5T101-311q-20 36-20 76.5t21 75.5q29 48 81.5 68.5T288-90Zm384 0q52 20 104.5-.5T858-159q21-35 21-75.5T859-311q-12 35-30.5 67.5T786-183q-24 28-52.5 51.5T672-90Zm-192-30q134 0 227-93t93-227q0-29-4.5-55.5T782-547q-29 20-64 31t-73 11q-102 0-173.5-71.5T400-750q-104 26-172 112t-68 198q0 134 93 227t227 93ZM360-350q-21 0-35.5-14.5T310-400q0-21 14.5-35.5T360-450q21 0 35.5 14.5T410-400q0 21-14.5 35.5T360-350Zm240 0q-21 0-35.5-14.5T550-400q0-21 14.5-35.5T600-450q21 0 35.5 14.5T650-400q0 21-14.5 35.5T600-350ZM94-544q9-33 23-63.5t33-57.5q19-27 41.5-51t48.5-44q-43 0-79.5 21T102-681q-20 32-22 67t14 70Zm772 0q16-35 14-70t-22-67q-22-37-58.5-58T720-760q26 20 48.5 44t41.5 51q19 27 33 57.5t23 63.5Zm-221-41q29 0 54-9t46-25q-21-32-50-57.5T632-721q-34-19-72-29t-80-10v10q0 69 48 117t117 48Zm-54-239q-20-26-49-41t-62-15q-33 0-62 15t-49 41q26-8 54-12t57-4q29 0 57 4t54 12ZM150-665Zm660 0Zm-330-85Zm0-90ZM174-183Zm612 0Z"})}),y=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"#FFF",viewBox:"0 -960 960 960",className:`animate-spin ${e.className}`,...e,children:s.jsx("path",{d:"M440-122q-121-15-200.5-105.5T160-440q0-66 26-126.5T260-672l57 57q-38 34-57.5 79T240-440q0 88 56 155.5T440-202v80Zm80 0v-80q87-16 143.5-83T720-440q0-100-70-170t-170-70h-3l44 44-56 56-140-140 140-140 56 56-44 44h3q134 0 227 93t93 227q0 121-79.5 211.5T520-122Z"})}),k=e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",...e,children:[s.jsx("path",{d:"M3 18a2 2 0 1 0 4 0 2 2 0 1 0-4 0M17 6a2 2 0 1 0 4 0 2 2 0 1 0-4 0"}),s.jsx("path",{d:"M19 8v5a5 5 0 0 1-5 5h-3l3-3m0 6-3-3M5 16v-5a5 5 0 0 1 5-5h3l-3-3m0 6 3-3"})]}),B={LoaderIcon:y,SlidesIcon:C,SwitchIcon:k,VoxIcon:V},$=({name:e,className:o,...t})=>{const n=B[e];return n?s.jsx(n,{className:o,...t}):(console.warn(`Icon "${e}" not found in iconMap`),null)};function Z({name:e,className:o,onClick:t,...n}){return s.jsx("div",{className:"bg-slate-500 p-2 rounded-full cursor-pointer",onClick:t,children:s.jsx($,{name:e,className:o,...n})})}function S({isLoading:e,...o}){return e?s.jsx("div",{className:"p-2",children:s.jsx(y,{})}):s.jsx(Z,{...o})}const F=e=>{window.postMessage({source:"button-accessor",type:"generateSlides",payload:e},window.location.origin)},h="https://chatgpt.com",v="https://www.mistral.ai",N="https://www.perplexity.ai",M={[h]:{selector:".markdown",platform:"chatgpt"},[v]:{selector:".message-content",platform:"mistral"},[N]:{selector:".user-message-content",platform:"perplexity"}},D=()=>{const e=window.location.href;if(e.includes(h))return e.split("/")[4];if(e.includes(v))return e.split("/")[4]},T=e=>{if(window.location.href.includes(h)){const t=e,n=t==null?void 0:t.parentElement;return n==null?void 0:n.parentElement}},U=e=>{const o=window.location.href;if(o.includes(h)){const t=T(e);return t==null?void 0:t.getAttribute("data-message-id")}else if(o.includes(v))return o.split("/")[4]},H=(e,o)=>{if(window.location.href.includes(h)){const n=e.querySelector(".markdown"),c=n==null?void 0:n.parentElement;c==null||c.setAttribute(`data-switch-format-${o}`,"chats");const i=document.createElement("div");i.setAttribute(`data-switch-format-${o}`,"slides"),i.style.display="none",e.appendChild(i)}},j=e=>{if(window.location.href.includes(h)){const t=T(e),n=t==null?void 0:t.getAttribute("data-message-id");return t.querySelector(`[data-switch-format-${n}]`)||H(t,n),t}};function O(){const e=g.useRef(null),[o,t]=g.useState(null),[n,c]=g.useState(null),[i,I]=g.useState("chats"),[x,f]=g.useState(!1);g.useEffect(()=>{if(e.current){const r=U(e.current);c(r)}},[]),g.useEffect(()=>{if(!e.current)return;const r=T(e.current),d=u=>{console.log("Received generateSlidesResponse event in React",u);const{payload:l,error:w}=u.detail;w?console.error("Error generating slides:",w):(console.log("Slides data in React:",l),t(l)),f(!1)};return console.log("Attaching event listener on:",r),r&&r.addEventListener("generateSlidesResponse",d),()=>{r&&r.removeEventListener("generateSlidesResponse",d)}},[e.current]),g.useEffect(()=>{if(o!=null&&o.length&&e.current){const r=j(e.current);console.log("currentdiv",r)}},[o,e.current]);const b=()=>{if(!e.current||!n)return;f(!0);const r=window.location.href,d=Object.keys(M).find(R=>r.includes(R));if(!d){console.error("Unsupported platform"),f(!1);return}const{selector:u,platform:l}=M[d],w=e.current,p=w==null?void 0:w.parentElement,q=p==null?void 0:p.parentElement,a=q==null?void 0:q.querySelector(u);console.log("Sending generateSlides message from React..."),F({messageId:n,data:(a==null?void 0:a.textContent)??"",model:l==="chatgpt"?"gpt-4.0":"mistral-large",platform:l,conversationId:D()}),console.log({innerHTML:a==null?void 0:a.innerHTML,textContent:a==null?void 0:a.textContent})},L=()=>{if(console.log("currentView",i),!e.current)return;const r=j(e.current);console.log("parentDiv",r);const d=i==="chats"?"slides":"chats",u=r.querySelector(`[data-switch-format-${n}="${i}"]`),l=r.querySelector(`[data-switch-format-${n}="${d}"]`);console.log("currentViewDiv",u),console.log("newViewDiv",l),u&&(u.style.display="none"),l&&(l.style.display="block"),I(d)};return s.jsxs("div",{className:"flex gap-2",ref:e,children:[o?`Slides: ${o.length}`:"No slides",n,s.jsx(Z,{name:"SwitchIcon",onClick:L}),s.jsx(S,{isLoading:x,name:"SlidesIcon",onClick:b}),s.jsx(S,{isLoading:x,name:"VoxIcon",onClick:b})]})}const E="https://chatgpt.com",P=[E],_={[E]:'div[data-message-author-role="assistant"][data-message-id]'};function Q(e,o){let t=null;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>e(...n),o)}}function G(e,o){if(e.hasAttribute("button-accessor-root")){console.log("Button already injected for message",o);return}const t=document.createElement("div");t.className="button-accessor-root",t.style.display="inline-block",t.style.marginLeft="10px",t.style.position="relative",t.textContent="Button",t.setAttribute("data-index",o.toString()),e.prepend(t),e.setAttribute("data-button-injected","true");try{A.createRoot(t).render(s.jsx(O,{})),console.log("ButtonAccessorViewer rendered for message",o)}catch(n){console.error("Error rendering ButtonAccessorViewer for message",o,n)}}function W(){console.log("Processing chat messages");const e=window.location.href,o=P.find(c=>e.includes(c));if(!o){console.log("Not a chat website. Exiting.");return}const t=_[o],n=document.querySelectorAll(`${t}:not([data-button-injected])`);console.log("Found unprocessed messages:",n.length),n.forEach((c,i)=>{G(c,i)})}const m=Q(W,100);document.addEventListener("DOMContentLoaded",()=>{console.log("DOM fully loaded"),m(),new MutationObserver(o=>{o.some(t=>t.addedNodes.length)&&(console.log("DOM changes detected, reprocessing messages"),m())}).observe(document.body,{childList:!0,subtree:!0})});setInterval(m,1e3);m();
